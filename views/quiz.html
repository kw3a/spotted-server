{{block "quizPage" .}}
<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <link href="/static/output.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      data-name="vs/editor/editor.main"
      href="/static/monaco-editor/min/vs/editor/editor.main.css"
    />
    <script src="/static/htmx.min.js" defer></script>
    <script src="/static/sse.js" defer></script>
    <title>Quiz Page</title>
  </head>

  <body class="bg-black">
    <div class="flex flex-row h-screen p-2 gap-2">
      <script>
        function changeProblem(id) {
          htmx.trigger("#problem-info", "evtproblemchange", {
            problem_id: id,
          });
          htmx.trigger("#examples", "evtproblemchange", {
            problem_id: id,
          });
          htmx.trigger("#language-select", "evtproblemchange", {
            problem_id: id,
          });
          htmx.trigger("#submit-button", "evtproblemchange", {
            problem_id: id,
          });
        }
      </script>
      <ul
        id="problem-selector"
        class="flex-none w-16 flex flex-col justify-evenly overflow-y-auto items-center bg-shark-950 border border-shark-900 rounded"
      >
        {{ $first := true }}
        {{range .Problems}}
        <li class="w-full p-2 flex items-center justify-center">
          <input
            id="radio-{{.ID}}"
            type="radio"
            name="selected-problem"
            value="{{.ID}}"
            class="hidden peer"
            data-problem_id="{{.ID}}"
            onclick="changeProblem(this.dataset.problem_id)"
            {{ if $first }} checked {{ end }}
          />
          <label
            for="radio-{{.ID}}"
            class="w-full text-center flex flex-col justify-center h-12 bg-shark-500 hover:bg-shark-600 text-white font-bold cursor-pointer rounded peer-checked:bg-blue-400"
          >
            {{.ProblemName}}
          </label>
        </li>
        {{ $first = false }}
        {{end}}
      </ul>
      <section
        id="workspace"
        class="flex-1 gap-2 overflow-y-auto xl:flex-row xl:flex"
      >
        <section
          id="problem-content"
          class="flex-1 xl:w-1/2 p-8 bg-shark-950 border border-shark-900 rounded overflow-y-auto"
        >
          <div
            id="problem-info"
            hx-get="/problems"
            hx-trigger="evtproblemchange"
            hx-vals="js:{problemID: event.detail.problem_id }"
          >
            {{template "problem" .ProblemContent}}
          </div>
          <hr class="p-2" />
          <div
            id="examples"
            hx-get="/examples"
            hx-trigger="evtproblemchange"
            hx-vals="js:{problemID: event.detail.problem_id }"
          >
            {{template "examples" .Examples}}
          </div>
        </section>
        <section id="editor-section" class="flex-1 xl:w-1/2 flex flex-col">
          <div
            id="code-editor"
            class="xl:h-3/4 rounded-t-lg border border-shark-900"
          ></div>
          {{template "codeEditor" .EditorData}}
          <form id="editor-form" class="h-1/12 text-xl flex flex-row">
            <select
              id="language-select"
              name="languageID"
              class="w-1/3 rounded-bl-lg bg-shark-950 border border-white text-white hover:border-shark-500 hover:text-shark-500 text-center"
              data-problem_id="{{(index .Problems 0).ID}}"
              hx-on:evtproblemchange="this.dataset.problem_id = event.detail.problem_id; this.dispatchEvent(new Event('change'));"
              hx-get="/source"
              hx-trigger="change"
              hx-swap="none"
              hx-vals="js:{problemID: event.target.dataset.problem_id}"
              hx-on::before-request="monaco.editor.setModelLanguage(editor.getModel(), this.selectedOptions[0].dataset.simple_name);"
              hx-on::after-request="editor.setValue(event.detail.xhr.responseText)"
            >
              {{template "languages" .Languages}}
            </select>
            <button
              id="submit-button"
              class="w-2/3 rounded-br-lg bg-shark-950 border border-green-400 text-green-400 hover:border-green-700 hover:text-green-700"
              hx-on:evtproblemchange="this.dataset.problem_id = event.detail.problem_id;"
              hx-post="/submissions"
              hx-swap="#results"
              data-quiz_id="{{.QuizID}}"
              data-problem_id="{{(index .Problems 0).ID}}"
              hx-vals="js:{quizID: event.target.dataset.quiz_id, problemID: event.target.dataset.problem_id}"
              hx-on::config-request="event.detail.parameters['src']=editor.getValue();"
              hx-target="#results"
            >
              Run
            </button>
          </form>
          <div
            id="results"
            class="flex-1 mt-2 p-4 bg-shark-950 rounded text-shark-400 border border-shark-900 overflow-y-auto"
          >
            <p>The results will be shown here</p>
          </div>
        </section>
      </section>
    </div>
  </body>
</html>
{{end}} {{block "problem" .}}
<h1 class="text-white">{{.Title}}</h1>
<hr />
<pre class="text-shark-200 whitespace-pre-wrap">{{.Description}}</pre>
{{end}} {{block "examples" .}}
<script>
  function copy(text) {
    navigator.clipboard.writeText(text);
  }
</script>
{{range .}}
<div class="flex flex-row gap-4">
  <div class="w-1/2 rounded bg-shark-900">
    <div class="flex justify-between pl-2">
      <span class="text-white">INPUT</span>
      <button class="bg-white w-5 rounded" onclick="copy('{{.Input}}')">
        <img src="/public/copypaste.png" alt="copy img" />
      </button>
    </div>
    <pre class="text-shark-200 p-4">{{.Input}}</pre>
  </div>
  <div class="w-1/2 rounded bg-shark-900">
    <div class="flex justify-between pl-2">
      <span class="text-white">OUTPUT</span>
      <button class="bg-white w-5 rounded" onclick="copy('{{.Output}}')">
        <img src="/public/copypaste.png" alt="copy img" />
      </button>
    </div>
    <pre class="text-shark-200 p-4">{{.Output}}</pre>
  </div>
</div>
<br />
{{end}} {{end}} {{block "codeEditor" .}}
<script src="/static/monaco-editor/min/vs/loader.js"></script>
<script>
  require.config({ paths: { vs: "/static/monaco-editor/min/vs" } });
  require(["vs/editor/editor.main"], function () {
    window.editor = monaco.editor.create(
      document.getElementById("code-editor"),
      {
        value: "{{.SrcValue}}",
        language: "{{.Language}}",
        theme: "vs-dark",
        minimap: { enabled: false },
        automaticLayout: true,
      },
    );
  });
</script>
{{end}} {{block "languages" .}} {{range .}}
<option value="{{.LanguageID}}" data-simple_name="{{.SimpleName}}">
  {{.DisplayedName}}
</option>
{{end}} {{end}} {{block "problemStatus" .}}
<div>
  <p>{{.Percentage}}% resolved</p>
</div>
{{end}} {{block "quizStatus" .}}
<p>{{.ResolvedProblems}} Of {{.NumberOfProblems}}</p>
{{end}} {{block "sseResults" .}}
<div hx-ext="sse" sse-connect="/results/{{.SubmissionID}}">
  <div sse-swap="result"></div>
  <div sse-swap="finished" hx-target="#results"></div>
</div>

{{end}}
