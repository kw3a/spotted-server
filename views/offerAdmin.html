{{block "offerAdmin" .}}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <script src="/static/htmx.min.js"></script>
    <link href="/static/output.css" rel="stylesheet" />
    <script src="/static/head-support.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  </head>

  <body class="bg-shark-950" hx-ext="head-support">
    {{template "navBar" .User}}
    <div class="flex justify-center p-4 text-shark-200">
      <section class="sm:w-full xl:w-3/4 flex flex-col gap-8">
        <div>
          <strong class="font-semibold text-2xl"
            >{{.Offer.Title}}</strong
          >
          <p class="text-shark-300 font-light">Publicado {{.Offer.RelativeTime}}</p>
        </div>

        <section class="flex flex-col border border-black p-4 gap-4">
          <strong class="text-shark-200 text-xl font-semibold text-center">Detalles de la prueba</strong>

          <div class="flex justify-around">
            <div class="flex justify-center">
              <p class="flex items-center text-shark-200 gap-2 font-medium">
                <img class="inline" src="/public/clock.svg" width="20" height="20" alt="clock icon" />
                {{.Quiz.Duration}} minutos
              </p>
            </div>
            <div class="flex justify-center rounded">
              <div class="flex flex-wrap gap-2 overflow-x-auto max-w-full">
                {{range .Languages}}
                <span class="rounded border border-shark-200 text-shark-200 px-2">{{.DisplayName}}</span>
                {{end}}
              </div>
            </div>
          </div>

          <div class="flex flex-col">
            <div class="flex flex-col">
              <p class="text-shark-200 text-center font-semibold">Problemas</p>
              <section class="flex flex-wrap justify-center gap-4 overflow-x-auto">
                {{range .Problems}}
                <div class="bg-shark-800 rounded">
                  <input 
                    type="radio" 
                    name="problem-group" 
                    id="problem-{{.ID}}" 
                    class="hidden peer"
                    onclick="openModal('modal-{{.ID}}')"
                  >
                  <label 
                    for="problem-{{.ID}}" 
                    class="block w-full hover:bg-gray-800 px-4 py-2 rounded cursor-pointer text-left peer-checked:bg-gray-800"
                  >
                    {{.Title}}
                  </label>
                </div>
                {{end}}
              </section>
            </div>

            <section class="relative">
              {{range .Problems}}
              <div id="modal-{{.ID}}" class="w-full bg-gray-800 absolute hidden rounded overflow-y-auto shadow-sm shadow-white/50">
                <div class="relative">
                  <button 
                    onclick="closeModal('modal-{{.ID}}')"
                    class="absolute top-2 right-2 p-2 text-gray-400 hover:text-white"
                  >
                    ✕
                  </button>
                  <div class="flex flex-col gap-2 p-8">
                    <pre class="whitespace-pre-wrap">{{.Description}}</pre>
                    <div class="flex flex-col">
                      <span 
                        class="text-shark-200"
                      >
                      Tiempo límite: {{.TimeLimit}} ms</span>
                      <span 
                        class="text-shark-200"
                      >
                      Memoria límite: {{.MemoryLimit}} kb</span>
                    </div>
                    {{template "examples" .Examples}}
                  </div>
                </div>
              </div>
              {{end}}
            </section>
          </div>

        </section>
        <script>
          function openModal(id) {
            document.querySelectorAll('[id^="modal-"]').forEach(modal => {
              modal.classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            document.body.style.overflow = 'hidden';
          }
          
          function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.body.style.overflow = '';
            document.querySelectorAll('input[name="problem-group"]').forEach(radio => {
              radio.checked = false;
            });
          }
          
          // Close modal when pressing Escape
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
              document.querySelectorAll('[id^="modal-"]').forEach(modal => {
                modal.classList.add('hidden');
              });
              document.body.style.overflow = '';
              document.querySelectorAll('input[name="problem-group"]').forEach(radio => {
                radio.checked = false;
              });
            }
          });
        </script>

        <div class="flex flex-col gap-4">
          <span class="text-xl text-center">Aplicantes</span>
          {{range .Applicants}} 
          {{template "applicantCard" .}} 
          {{end}}
        </div>
      </section>
    </div>
  </body>
</html>
{{end}} 

{{block "applicantCard" .}}
<div class="flex flex-row rounded border border-shark-900 p-4">
  <div class="w-1/4 flex flex-col justify-center gap-2">
    <div class="flex flex-row justify-center">
      <img
        class="w-1/2 h-auto border border-gray-700 hover:border-white aspect-square mx-auto object-cover cursor-pointer"
        hx-get="/profile/{{.Applicant.ID}}"
        hx-push-url="true"
        hx-target="body"
        hx-boost="true"
        {{if
        .Applicant.ImageURL}}
        src="{{.Applicant.ImageURL}}"
        {{else}}
        src="/public/user.svg"
        {{end}}
        width="40"
        height="40"
      />
    </div>
    <span class="text-center font-semibold text-xl"
      >{{.Applicant.Name}}</span
    >
    <span class="text-center">{{.Applicant.Email}}</span>
  </div>
  <div class="w-3/4 p-8">
    <span class="text-shark-300 font-light">Entregado {{.Participation.RelativeTime}}</span>
      <div class="flex justify-between">
        <span class="text-shark-200 text-xl font-semibold">Problema</span>
        <span class="text-shark-200 text-xl font-semibold">Puntaje</span>
      </div>
    <div class="flex flex-col gap-2">
      {{ $applicant := .Applicant }}
      {{range .Results}}
      <details
        class="bg-gray-900"
      >
        <summary class="flex-auto flex hover:bg-gray-800 justify-between cursor-pointer p-2"
          hx-get="/source/{{.Problem.ID}}/{{$applicant.ID}}"
          hx-trigger="click once"
          hx-target="#appl-{{$applicant.ID}}-{{.Problem.ID}}"
          hx-swap="outerHTML"
        >
          <span class="text-shark-200">{{.Problem.Title}}</span>
          {{if eq .Score.AcceptedTestCases 0}}
          <span class="text-red-500">
          {{else}}
            {{if eq .Score.AcceptedTestCases .Score.TotalTestCases}}
          <span class="text-green-600">
            {{else}}
          <span class="text-yellow-600">
            {{end}}
          {{end}}
            {{.Score.AcceptedTestCases}}/{{.Score.TotalTestCases}}</span>
        </summary>
        <section id="appl-{{$applicant.ID}}-{{.Problem.ID}}"></section>
      </details>
      {{end}}
    </div>
  </div>
</div>
{{end}}

{{block "sourceCard" .}}
<section class="p-4">
  <pre id="sbm-{{.Submission.ID}}">
    <code>{{.Submission.Src | html}}
    </code>
  </pre>
  <span>Casos de prueba</span>
  <div class="flex flex-col gap-4">
  {{range .TestCases}}
    <details class="p-2">
      <summary class="flex bg-shark-950 hover:bg-gray-800 p-2">
        {{if eq .Result.Status "Accepted"}}
        <span class="w-1/3 text-green-600">{{.Result.Status}}</span>
        {{else}}
        <span class="w-1/3 text-red-500">{{.Result.Status}}</span>
        {{end}}
        <span class="w-1/3 flex items-center gap-2">
          <img class="inline" src="/public/clock.svg" width="20" height="20" alt="clock icon" />
          {{.Result.Time}} ms
        </span>
        <span class="w-1/3">{{.Result.Memory}} Kb</span>
      </summary>
      <div class="flex">
        <div class="w-1/2 flex flex-col p-4">
          <span>Entrada</span>
          <pre class="bg-shark-950 p-2">{{.TestCase.Input}}</pre>
          <span>Salida esperada</span>
          <pre class="bg-shark-950 p-2">{{.TestCase.Output}}</pre>
        </div>
        <div class="w-1/2 flex flex-col p-4">
          <div>
            <span>Salida obtenida</span>
            <pre class="bg-shark-950 p-2">{{.Result.Output}}</pre>
          </div>
        </div>
      </div>
    </details>
  {{end}}
  </div>
  <script>hljs.highlightElement(document.getElementById("sbm-{{.Submission.ID}}"));</script>
</section>
{{end}}

{{block "noSourceCard" .}}
<div class="flex flex-col px-4 py-2 rounded bg-gray-900">
  <span>{{.Msg}}</span>
</div>
{{end}}
